<!DOCTYPE html>

<html lang="en">
<head>
  <link href=
    "//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../stylesheets/style.css">

<script type="text/javascript">

  var activeGroup;

  function retrieveGroups() {
    $.getJSON('/groupme/groups', function(elements) {
      console.log(elements);
      console.log(elements.length);
      if (elements != undefined) {
        var htmlOut = "";
        for (var i=0; i<elements.length; i++) {
          htmlOut += "<div class='conversationBox' id='" + elements[i].id + "' onClick='makeActive(" + i + ")'>" + elements[i].conversationName + "</div>";
        }
        $("#content").html(htmlOut);
      } else {
        var htmlOut = "No conversations found."
        $("#content").html(htmlOut);
      }
    });
  }

  function makeActive(i) {
    activeGroup = i;
    console.log(activeGroup);
  }

  function checkActive() {
    return activeGroup;
  }

  function sendMessage() {
    var content = $("#messageContent").val();
    var id = activeGroup;
    var data = {message: content, group_id: id};
    /*$.ajax({
      type: "POST",
      url: '/groupme/send',
      data: data,
      success: success
    });
    console.log('it happened');*/
    return false;
  }
</script>

</head>

<body>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-md-3" id="groupsList">
                <!--List of Messages-->

                <h3>List of Conversations</h3>
                <center>

                <form action="" method="" onSubmit="return false">
                  <input type="submit" value="Retrieve Groups" onClick="retrieveGroups()"><br>
                  <div id="content"></div>
                </form>
              </center>
            </div>

            <div class="col-md-5" id="currConversation">
                <!--Body content of Open Message-->

                <h3>Active Conversation</h3>
                <form onSubmit="return sendMessage()">
                  <input id="messageContent" type="text" placeholder="Enter a message">
                  <button class="btn" type="submit">Send</button>
                </form>

            </div>

            <div class="col-md-3" id="metricsPane">
                <!--Metrics and search engine-->

                <h3>Metrics</h3>

                <form class="form-search">
                    <input class="input-medium search-query" type="text">
                    <button class="btn" type="submit">Search</button>
                </form>
            </div>
        </div>
    </div><br>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</body>
</html>